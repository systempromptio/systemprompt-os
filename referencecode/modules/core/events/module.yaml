name: events
displayName: Events System
version: 1.0.0
description: Unified event-driven architecture for SystemPrompt OS. Handles event registration, execution, scheduling, and complex workflow orchestration.
author: SystemPrompt OS Team
category: core
stability: stable

# Module dependencies
dependencies:
  - name: database
    version: ">=1.0.0"
  - name: logger
    version: ">=1.0.0"
  - name: auth
    version: ">=1.0.0"
  - name: webhooks
    version: ">=1.0.0"
    optional: true

# Module exports
exports:
  services:
    - EventService
    - EventBus
    - ExecutorRegistry
  types:
    - Event
    - EventExecution
    - EventHandler
    - EventListener
    - EventSchedule
    - WorkflowDefinition
    - IEventExecutor

# Configuration schema
config:
  type: object
  properties:
    processing:
      type: object
      properties:
        maxConcurrentEvents:
          type: number
          default: 100
          description: Maximum number of concurrent event executions
        retryDelayMs:
          type: number
          default: 1000
          description: Default retry delay in milliseconds
        maxRetries:
          type: number
          default: 3
          description: Default maximum retry attempts
    scheduling:
      type: object
      properties:
        checkIntervalMs:
          type: number
          default: 10000
          description: Interval for checking scheduled events
        timezone:
          type: string
          default: "UTC"
          description: Default timezone for scheduling
    executors:
      type: object
      properties:
        webhook:
          type: object
          properties:
            enabled:
              type: boolean
              default: true
            maxConcurrency:
              type: number
              default: 100
        command:
          type: object
          properties:
            enabled:
              type: boolean
              default: true
            maxConcurrency:
              type: number
              default: 10
            defaultTimeoutMs:
              type: number
              default: 30000
        workflow:
          type: object
          properties:
            enabled:
              type: boolean
              default: true
            maxConcurrency:
              type: number
              default: 20
            checkpointEnabled:
              type: boolean
              default: true

# Permissions
permissions:
  - event:create
  - event:read
  - event:update
  - event:delete
  - event:execute
  - handler:create
  - handler:read
  - handler:update
  - handler:delete
  - listener:create
  - listener:read
  - listener:update
  - listener:delete
  - schedule:create
  - schedule:read
  - schedule:update
  - schedule:delete
  - workflow:create
  - workflow:read
  - workflow:update
  - workflow:delete
  - workflow:execute
  - command:execute
  - webhook:trigger

# Database migrations
database:
  schema: ./database/schema.sql
  migrations:
    - version: "1.0.0"
      description: "Initial schema with events, executions, handlers, listeners, schedules, workflows"
      up: ./database/schema.sql

# CLI commands
cli:
  commands:
    - name: "event:create"
      description: "Create a new event"
      handler: ./cli/event-create.ts
    - name: "event:list"
      description: "List events"
      handler: ./cli/event-list.ts
    - name: "event:info"
      description: "Get event information"
      handler: ./cli/event-info.ts
    - name: "event:cancel"
      description: "Cancel an event"
      handler: ./cli/event-cancel.ts
    - name: "handler:register"
      description: "Register an event handler"
      handler: ./cli/handler-register.ts
    - name: "handler:list"
      description: "List event handlers"
      handler: ./cli/handler-list.ts
    - name: "listener:register"
      description: "Register an event listener"
      handler: ./cli/listener-register.ts
    - name: "listener:list"
      description: "List event listeners"
      handler: ./cli/listener-list.ts
    - name: "schedule:create"
      description: "Create an event schedule"
      handler: ./cli/schedule-create.ts
    - name: "schedule:list"
      description: "List event schedules"
      handler: ./cli/schedule-list.ts
    - name: "workflow:create"
      description: "Create a workflow"
      handler: ./cli/workflow-create.ts
    - name: "workflow:list"
      description: "List workflows"
      handler: ./cli/workflow-list.ts
    - name: "workflow:execute"
      description: "Execute a workflow"
      handler: ./cli/workflow-execute.ts
    - name: "stats"
      description: "Show event statistics"
      handler: ./cli/stats.ts

# Event types this module can handle
eventTypes:
  - system.*
  - webhook.*
  - workflow.*
  - task.*
  - schedule.*
  - api.*

# Module initialization
init:
  priority: 1
  handler: ./index.ts