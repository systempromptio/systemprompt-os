name: auth
type: core
version: 2.0.0
description: Authentication and authorization with tokens and OAuth2/OIDC providers
author: SystemPrompt OS Team <team@systemprompt-os.com>
config:
  keyStorePath: ./state/auth/keys
  tokenExpiry: 86400
  allowedAlgorithms:
    - RS256
    - RS384
    - RS512
  providers:
    # OAuth2/OIDC provider configurations are loaded from:
    # - providers/*.yaml (built-in providers like google.yaml, github.yaml)
    # - providers/custom/*.yaml (user-defined providers)
    # 
    # Enable providers by setting their credentials in environment variables:
    # - GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET for Google
    # - GITHUB_CLIENT_ID and GITHUB_CLIENT_SECRET for GitHub
    # 
    # See providers/template.yaml for creating custom providers
    path: ./providers
dependencies:
  - logger
  - database
apis:
  # APIs exposed by this module for other modules/server to use
  - name: getProvider
    description: Get a specific OAuth2/OIDC provider by ID
  - name: getAllProviders
    description: Get all configured providers
  - name: hasProvider
    description: Check if a provider is available
  - name: reloadProviders
    description: Reload provider configurations from disk
cli:
  commands:
    - name: status
      description: Show auth module status and health information
      options:
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text
    - name: authenticate
      description: Authenticate user credentials
      options:
        - name: email
          alias: e
          type: string
          description: User email address
          required: true
        - name: password
          alias: p
          type: string
          description: User password
          required: true
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text  
    - name: session:create
      description: Create a new user session
      options:
        - name: user-id
          alias: u
          type: string
          description: User ID (UUID format)
          required: true
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text
    - name: session:list
      description: List sessions for a user
      options:
        - name: user-id
          alias: u
          type: string
          description: User ID (UUID format)
          required: true
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text
        - name: limit
          alias: l
          type: number
          description: Maximum number of sessions to return
          default: 20
        - name: page
          alias: p
          type: number
          description: Page number for pagination
          default: 1
    - name: session:validate
      description: Validate a session token
      options:
        - name: session-id
          alias: s
          type: string
          description: Session ID (UUID format)
          required: true
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text
    - name: session:revoke
      description: Revoke an active session
      options:
        - name: session-id
          alias: s
          type: string
          description: Session ID (UUID format)
          required: true
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text
    - name: providers:list
      description: List configured OAuth providers
      options:
        - name: format
          alias: f
          type: string
          description: Output format
          choices: ['text', 'json']
          default: text