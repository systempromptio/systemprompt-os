name: auth
type: service
version: 2.0.0
description: Enhanced authentication with MFA, tokens, and audit logging
author: SystemPrompt OS Team <team@systemprompt-os.com>
config:
  keyStorePath: ./state/auth/keys
  tokenExpiry: 86400
  allowedAlgorithms:
    - RS256
    - RS384
    - RS512
  providers:
    # OAuth2/OIDC provider configurations are loaded from:
    # - providers/*.yaml (built-in providers like google.yaml, github.yaml)
    # - providers/custom/*.yaml (user-defined providers)
    # 
    # Enable providers by setting their credentials in environment variables:
    # - GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET for Google
    # - GITHUB_CLIENT_ID and GITHUB_CLIENT_SECRET for GitHub
    # 
    # See providers/template.yaml for creating custom providers
    path: ./providers
dependencies:
  - logger
  - database
apis:
  # APIs exposed by this module for other modules/server to use
  - name: getProvider
    description: Get a specific OAuth2/OIDC provider by ID
  - name: getAllProviders
    description: Get all configured providers
  - name: hasProvider
    description: Check if a provider is available
  - name: reloadProviders
    description: Reload provider configurations from disk
cli:
  commands:
    - name: status
      description: Show auth module status (enabled/healthy)
    - name: generatekey
      description: Generate cryptographic keys for JWT signing
      options:
        - name: type
          alias: t
          type: string
          description: Key type (currently only "jwt" is supported)
          default: jwt
        - name: algorithm
          alias: a
          type: string
          description: Algorithm (RS256, RS384, or RS512)
          default: RS256
        - name: output
          alias: o
          type: string
          description: Output directory
        - name: format
          alias: f
          type: string
          description: Output format (pem or jwk)
          default: pem
    - name: providers
      description: List configured OAuth2/OIDC providers
      subcommands:
        - name: list
          description: List all configured providers
        - name: reload
          description: Reload provider configurations
    - name: db
      description: Database management commands
      subcommands:
        - name: reset
          description: Reset the authentication database (removes all users, roles, and sessions)
        - name: list-users
          description: List all users and their roles
    - name: role
      description: Role management commands
      subcommands:
        - name: grant
          description: Grant a role to a user
          options:
            - name: user
              alias: u
              type: string
              description: User email or ID
              required: true
            - name: role
              alias: r
              type: string
              description: Role name (admin or user)
              required: true
        - name: revoke
          description: Revoke a role from a user
          options:
            - name: user
              alias: u
              type: string
              description: User email or ID
              required: true
            - name: role
              alias: r
              type: string
              description: Role name (admin or user)
              required: true