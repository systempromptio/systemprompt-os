# Types Subfolder Rules

## Purpose
Types define the TypeScript interfaces, types, and schemas for the module. **ALL TYPES ARE AUTO-GENERATED** except for very specific manual exceptions.

## CRITICAL RULE: AUTO-GENERATION ONLY

**ðŸš¨ ALL FILES IN THIS DIRECTORY ARE AUTO-GENERATED ðŸš¨**

Types are generated by the Type Guard Generator Service (`/src/modules/core/dev/services/type-guard-generator.service.ts`) from:
1. **Database schema** (`database/schema.sql`)
2. **Service implementation** (TypeScript AST analysis)
3. **Module exports** (interface analysis)

## Auto-Generated Files (DO NOT EDIT)

### database.generated.ts
- **Source**: `database/schema.sql`
- **Contains**: Table row interfaces, enum types from CHECK constraints
- **Generated via**: SQL parsing and TypeScript generation
- **Example**: `IConfigRow`, `ConfigStatus` enum

### config.module.generated.ts
- **Source**: Service method signatures + domain logic
- **Contains**: Domain interfaces, service interfaces, module exports interface
- **Generated via**: TypeScript AST analysis of service implementations
- **Example**: `IConfig`, `IConfigService`, `IConfigModuleExports`

### config.service.generated.ts
- **Source**: Service method signatures
- **Contains**: Service validation schemas, module schemas
- **Generated via**: TypeScript AST analysis + Zod generation
- **Example**: `ConfigServiceSchema`, `ConfigModuleExportsSchema`

## Generation Triggers

Types are regenerated when:
1. **Database schema changes** (`database/schema.sql` modified)
2. **Service methods change** (service implementation modified)
3. **Manual regeneration** via CLI command:
   ```bash
   npx tsx src/modules/core/dev/cli/generate-types.ts config
   ```

## Manual Types (HIGHLY RESTRICTED)

### When Manual Types Are Allowed
**ONLY** in these rare cases:
- CLI-specific types that cannot be generated from database or services
- Complex union types for very specific business logic
- Integration types for external APIs
- Utility types for internal module use

### Manual Type Requirements
If manual types are absolutely necessary:

1. **File naming**: Must use `.manual.ts` suffix
   - âŒ `custom-types.ts`
   - âœ… `custom-types.manual.ts`

2. **Documentation**: Must include justification comment:
   ```typescript
   /**
    * MANUAL TYPE JUSTIFICATION:
    * These types cannot be auto-generated because:
    * - [Specific technical reason]
    * - [Business requirement that cannot be captured in schema/service]
    * 
    * Last reviewed: [Date]
    * Review required if: [Conditions for review]
    */
   ```

3. **Review requirement**: Manual types require code review approval
4. **Minimal scope**: Keep manual types as small as possible

### Example Manual Type File
```typescript
// cli-integration.manual.ts

/**
 * MANUAL TYPE JUSTIFICATION:
 * CLI integration types that bridge module services with CLI framework.
 * These cannot be generated because they require knowledge of CLI internals
 * and command-specific formatting requirements.
 * 
 * Last reviewed: 2024-01-15
 * Review required if: CLI framework changes or service interfaces change
 */

import type { IConfig } from './config.module.generated';

export interface CliConfigDisplayFormat {
  config: IConfig;
  displayFormat: 'table' | 'json' | 'compact';
  includeMetadata: boolean;
}

export interface CliConfigSearchOptions {
  query: string;
  limit?: number;
  format?: 'table' | 'json';
}
```

## Type Import Patterns

### From Generated Files
```typescript
// Import domain interfaces
import type { IConfig, IConfigService } from '@/modules/core/config/types/config.module.generated';

// Import database types
import type { IConfigRow, ConfigStatus } from '@/modules/core/config/types/database.generated';

// Import service schemas for validation
import { ConfigServiceSchema } from '@/modules/core/config/types/config.service.generated';
```

### External Type Usage
```typescript
// In services
import type { IConfig } from '@/modules/core/config/types/config.module.generated';

// In repositories  
import type { IConfigRow } from '@/modules/core/config/types/database.generated';

// In CLI commands
import type { IConfig } from '@/modules/core/config/types/config.module.generated';
```

## Type Validation

### Generated Type Validation
The system automatically validates:
- Database schema consistency with generated types
- Service interface compliance with implementations
- Zod schema correctness
- Module export interface completeness

### Manual Type Validation
Manual types must:
- Not conflict with generated types
- Follow TypeScript naming conventions
- Include proper JSDoc documentation
- Export only necessary interfaces

## Regeneration Process

### Automatic Regeneration
Triggered by:
- Database schema changes during development
- Service implementation changes
- Module bootstrap process

### Manual Regeneration
```bash
# Regenerate types for specific module
npx tsx src/modules/core/dev/cli/generate-types.ts config

# Regenerate all module types
npx tsx src/modules/core/dev/cli/generate-types.ts --all
```

### Regeneration Safety
- Generated files include timestamps and generation markers
- Backup copies are created before regeneration
- Validation ensures generated types are syntactically correct
- Failed generation preserves existing types

## Forbidden Patterns

**NEVER**:
- Edit auto-generated files manually
- Create TypeScript files without `.manual.ts` suffix (except generated ones)
- Import types from other modules' manual files
- Create complex business logic in type definitions
- Use `any` type in interface definitions
- Create duplicate interfaces that could be generated

## Integration with Module System

### Module Exports Interface
Every module MUST have a generated module exports interface:
```typescript
// Auto-generated in config.module.generated.ts
export interface IConfigModuleExports {
  readonly service: () => IConfigService;
}
```

### Type Guard Integration
Generated types integrate with module type guards:
- Type guards validate module exports at runtime
- Ensure type safety across module boundaries
- Enable safe dynamic module loading

### Build Process Integration
- Types are validated during TypeScript compilation
- Generated types are included in build artifacts
- Type generation is part of the CI/CD pipeline

The types system ensures **complete type safety** while minimizing manual maintenance through comprehensive auto-generation from authoritative sources (database schema and service implementations).